<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groups - Year <%= yearLevel %></title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <a href="/" class="back-btn">‚Üê Back to Year Levels</a>
            <h1><%= getYearLevelText(yearLevel) %> Groups</h1>
        </div>
        <a href="/add-group/<%= yearLevel %>" class="add-group-btn">Add New Group</a>
        <div class="groups-container">
            <!-- Groups will be dynamically loaded here -->
        </div>
    </div>

    <script type="module">
        import { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        import { db } from '/js/firebase-config.js';

        const yearLevel = <%= yearLevel %>;

        const loadGroups = async () => {
            const groupsContainer = document.querySelector('.groups-container');
            try {
                // Create a query to filter groups by year level
                const groupsQuery = query(
                    collection(db, 'groups'),
                    where('yearLevel', '==', yearLevel)
                );
                
                const querySnapshot = await getDocs(groupsQuery);
                const groupElements = querySnapshot.docs.map(doc => {
                    const group = doc.data();
                    const membersList = group.members?.map(member => 
                        `<li>${member.name} (${member.studentId})</li>`
                    ).join('') || '';
                    
                    return `
                        <div class="group-card">
                            <h2>Group ${group.groupNumber}</h2>
                            <p class="project-title">${group.projectTitle}</p>
                            <div class="members-list">
                                <h3>Members:</h3>
                                <ul>${membersList}</ul>
                            </div>
                            <div class="group-actions">
                                <a href="${group.docsLink}" target="_blank" class="docs-link">View Documentation</a>
                                <a href="/group/${doc.id}/rubric" class="grade-btn">Grade Project</a>
                            </div>
                        </div>
                    `;
                });

                if (groupElements.length === 0) {
                    groupsContainer.innerHTML = '<p class="no-groups">No groups found for this year level. Add a new group to get started.</p>';
                } else {
                    groupsContainer.innerHTML = groupElements.join('');
                }
            } catch (error) {
                console.error("Error loading groups:", error);
                groupsContainer.innerHTML = '<p class="error">Error loading groups. Please try again later.</p>';
            }
        };

        document.addEventListener('DOMContentLoaded', loadGroups);
    </script>
</body>
</html> 